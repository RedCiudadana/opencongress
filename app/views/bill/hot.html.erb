<% @content_for_sortby = render :partial => 'sort_bills', :locals => { :sort => 'hot'} %>

<%= render :partial => "hot_bills_header" %>

<% cache(@cache_key, :expires_in => 20.minutes) do %>
  <table class="thunderdome" cellspacing="0" cellpadding="0">
    <tr>
      <th class="rank">Rank</th>
      <th class="main_title">Bills</th>
      <th class="votes_td"><%= th_sort("<span>Votes</span>".html_safe, "votes", "desc") %></th>
      <th class="ayes_td aye"><%= th_sort("<span>Ayes</span>".html_safe, "support", "desc") %></th>
      <th class="nays_td nay"><%= th_sort("<span>Nays</span>".html_safe, "oppose", "desc") %></th>
      <th colspan="2" class="vote_td">Vote!</th></tr>
    <% count = 0 %>
    <% (2..params[:page].to_i).each {|i| count += 20} %>
    <% @results.each do |bill| %>
      <% count += 1 %>
      <tr>
        <td class="bill_rank">
          <span class="hot_bill_rank <%= bill_rank_diff_class_name(@ranking_diff[bill.id]) %>" %>
            <%= (@ranking_lookup[bill.id][:rank][:ordinal] + 1).ordinalize %>
            <% if @ranking_lookup[bill.id][:rank][:peers] > 1 %>(T)<% end %>
          </span>
        </td>
        <td valign="top" class="bills" id="<%= bill.ident %>">
          <span class="count bill"><%= count %></span>

          <div class="title">
            <%= link_to truncate(bill.best_title(:prefixed), :length => 103), :controller => 'bill', :action => 'show', :id => bill.ident %>

            <% unless bill.official_title == bill.best_title(:plain) %>
              <p><%= truncate(bill.official_title, :length => 145) %></p>
            <% end %>
          </div>        

          <span class="status">            

            <span><%= bill.status %></span>

            <span class="date"><%= bill.last_action.formatted_date if bill.last_action %></span>
            <% unless bill.session == Settings.default_congress %>
              <span>(<%= bill.session.ordinalize %> congress)</span>
            <% end %>

          </span>

          <span class="linkage">
            <%= link_to "<span class='news_11'>News</span>".html_safe, :controller => 'bill', :action => 'news', :id => bill.ident %>
            <%= link_to "<span class='blogs_11'>Blogs</span>".html_safe, :controller => 'bill', :action => 'blogs', :id => bill.ident %>
            <%= link_to "<span class='comments_11'>Comments</span>".html_safe, :controller => 'bill', :action => 'comments', :id => bill.ident %>
          </span>

        </td>
        <td valign="top" class="br_td"><%= @ranking_lookup[bill.id][:counts][:votes] || "0" %></td>
        <td valign="top" class="br_td"><span id="<%= "support_#{bill.id}"%>" class="aye"><%= @ranking_lookup[bill.id][:counts][:support] || 0 %></span></td>
        <td class="br_td"><span id="<%= "oppose_#{bill.id}"%>" class="nay"><%= @ranking_lookup[bill.id][:counts][:oppose] || 0 %></span></td>

        <td id="<%= "vote_results_#{bill.id.to_s}"%>" class="br_td vote_line">
          <%= draw_inline_user_bill_vote(bill) %>
        </td>
      </tr>
      <tr style="display:none;">
        <td colspan="8"><p id="vote_message_<%= bill.id.to_s %>"></p></td>
      </tr>
    <% end %>
  </table>

  <script type="text/javascript">
    $j().ready(function() {
      $j('#login_vote').jqm({ajax:'@href', trigger: 'a.modal_fire'});
    });
  </script>
  <div id="login_vote" class="jqmWindow">
  </div>
<% end %>

<% if @bill %>
  <% javascript_tag :defer => 'defer' do -%>
    new Effect.ScrollTo('<%= @bill.ident %>');
    new Effect.Highlight('<%= @bill.ident %>', {duration: 8} );
  <% end -%>
<% end %>

